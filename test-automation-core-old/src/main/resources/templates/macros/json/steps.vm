#macro(includeSteps, $steps)

<div class="steps inner-level">
  #set($stepsId = $counter.next())
  <div data-toggle="collapse" class="#if ($element.getStatus().isPassed()) collapsed #end collapsable-control" data-target="#steps-$stepsId">
    #includeBrief("Steps", $element.getStepsStatus(), "", true)
  </div>

  <div id="steps-$stepsId" class="inner-level collapse collapsable-details collapsable-step-details #if (!$element.getStatus().isPassed() || $expand_all_steps) in #end">
    #foreach($step in $element.getSteps())
      <div class="step">
        #set($attachmentBlockId = $counter.next())
        #includeStepName($step.getKeyword(), $step.getName(), $step.getMatch().getArguments(), $step.getResult().getStatus(), $step.getResult(), $attachmentBlockId)

        #set($isPassed = $step.getResult().getStatus().isPassed())
        #set($isFailed = $isPassed == false)

        #includeHooks("Before", $step.getBefore(), $step.getBeforeStatus(), "step")
        #includeMessage($step.getResult().getErrorMessageTitle(), $step.getResult().getErrorMessage(), $isPassed)

        #if (!$step.getRows().isEmpty())
          <table class="step-arguments table table-striped table-fit-content">
            #foreach($row in $step.getRows())
              <tr>
                #foreach($cell in $row.getCells())
                  <td>$cell</td>
                #end
              </tr>
            #end
          </table>
        #end

        #includeDocString($step.getDocString())
        #includeOutput($step.getOutputs(), $isPassed)
        #includeEmbeddings($step.getEmbeddings(),$attachmentBlockId, $isFailed)
        #includeHooks("After", $step.getAfter(), $step.getAfterStatus(), "step")
      </div>
    #end
  </div>
</div>

#end
